<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¹Ø§Ù‹ Ù„Ù†Ø³Ø§Ø¹Ø¯ | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f1f5f9; transition: all 0.3s; }
        .page { display: none; min-height: 100vh; }
        .page.active { display: flex; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.98); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(15px); padding: 20px; }
        .modal.active { display: flex; }

        /* ØªØ°Ø¨Ø°Ø¨ Ø§Ù„Ø±Ø§Ø¯Ø§Ø± */
        .radar-wave {
            position: absolute;
            border: 3px solid #ef4444;
            border-radius: 50%;
            animation: ripple 2s linear infinite;
        }
        @keyframes ripple {
            0% { width: 100px; height: 100px; opacity: 1; }
            100% { width: 400px; height: 400px; opacity: 0; }
        }

        .emergency-flash { animation: flash-red 0.5s infinite; }
        @keyframes flash-red { 0%, 100% { background-color: #f1f5f9; } 50% { background-color: #fee2e2; } }

        /* Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ÙŠØ¯ (Rigging) */
        .finger { transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); transform-origin: bottom center; }
        .hand-move { transition: transform 0.6s ease-in-out; }
    </style>
</head>
<body id="main-body">

    <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="home" class="page active flex-col">
        <header class="p-6 bg-white shadow-sm flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-3 rounded-2xl text-white shadow-lg">ğŸ¤Ÿ</div>
                <div>
                    <h1 class="text-2xl font-black text-slate-800">Ù…Ø¹Ø§Ù‹ Ù„Ù†Ø³Ø§Ø¹Ø¯</h1>
                    <p class="text-xs text-slate-500 font-bold">Ø¨Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ù…Ø¹Ù„Ù…Ø©: Ø£Ø­Ù„Ø§Ù… Ø§Ù„Ø³Ø§Ù„Ù…ÙŠ</p>
                </div>
            </div>
            <div class="text-right text-sm">
                <p class="font-bold text-slate-700">ØªÙ†ÙÙŠØ°: <span class="text-blue-600">ÙÙˆØ²ÙŠØ© Ø§Ù„Ø³ÙŠØ¯ ÙˆØ®ÙˆÙ„Ø© Ø§Ù„ØºØ§Ù…Ø¯ÙŠ</span></p>
                <p class="text-slate-500 text-xs">Ù…Ø³Ø§Ø¹Ø¯Ø© Ø®Ø§Ø±Ø¬ÙŠØ©: Ù…Ø±ÙŠØ§Ù† Ø±ØµØ±Øµ ÙˆØ³Ù…ÙŠØ© ÙØ®Ø±Ùˆ</p>
            </div>
        </header>

        <main class="p-8 max-w-6xl mx-auto w-full grid grid-cols-1 md:grid-cols-3 gap-8 mt-10">
            <!-- Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª -->
            <div onclick="openModal('radar-modal')" class="bg-white p-10 rounded-[50px] shadow-xl hover:shadow-2xl transition-all cursor-pointer border-b-8 border-red-500 group">
                <div class="text-6xl mb-6 group-hover:scale-110 transition-transform">ğŸ””</div>
                <h3 class="text-2xl font-black">Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª</h3>
                <p class="text-slate-500 mt-2 italic text-sm">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø³Ø§Ø³Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…Ø­ÙŠØ·Ø© (Ø¨ÙˆÙ‚ØŒ ØµØ±Ø§Ø®ØŒ Ø¬Ø±Ø³)</p>
            </div>

            <!-- Ø§Ù„Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ù…ØªØ±Ø¬Ù… -->
            <div onclick="openModal('avatar-modal')" class="bg-white p-10 rounded-[50px] shadow-xl hover:shadow-2xl transition-all cursor-pointer border-b-8 border-purple-600 group">
                <div class="text-6xl mb-6 group-hover:scale-110 transition-transform">ğŸ¤–</div>
                <h3 class="text-2xl font-black">Ø§Ù„Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ø°ÙƒÙŠ</h3>
                <p class="text-slate-500 mt-2 italic text-sm">Ù…ØªØ±Ø¬Ù… ÙÙˆØ±ÙŠ ÙŠØ­ÙˆÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø­Ø±ÙƒØ§Øª Ø¥Ø´Ø§Ø±ÙŠØ© Ù…ØªÙ‚Ù†Ø©</p>
            </div>

            <!-- Ù…ØªØ±Ø¬Ù… Ø§Ù„ÙŠØ¯ -->
            <div onclick="openModal('cam-modal')" class="bg-white p-10 rounded-[50px] shadow-xl hover:shadow-2xl transition-all cursor-pointer border-b-8 border-blue-600 group">
                <div class="text-6xl mb-6 group-hover:scale-110 transition-transform">âœ‹</div>
                <h3 class="text-2xl font-black">Ù…ØªØ±Ø¬Ù… Ø§Ù„ÙŠØ¯ (AI)</h3>
                <p class="text-slate-500 mt-2 italic text-sm">ÙŠÙÙ‡Ù… Ø¥Ø´Ø§Ø±Ø§ØªÙƒ ÙˆÙŠØ­ÙˆÙ„Ù‡Ø§ Ù„Ù†Øµ ÙˆØµÙˆØª Ù…Ø³Ù…ÙˆØ¹</p>
            </div>
        </main>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø§Ø¯Ø§Ø± (Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰) -->
    <div id="radar-modal" class="modal">
        <div class="bg-white p-10 rounded-[60px] w-full max-w-lg text-center shadow-2xl relative overflow-hidden">
            <button onclick="closeModals()" class="absolute top-8 left-8 text-3xl font-bold text-slate-300">Ã—</button>
            <h2 class="text-3xl font-black text-red-600 mb-6">Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¢Ù…Ù†</h2>
            
            <div id="radar-visual" class="relative w-64 h-64 mx-auto mb-8 bg-slate-50 rounded-full flex items-center justify-center border-8 border-white shadow-inner">
                <div id="mic-icon" class="text-7xl z-10 transition-transform duration-100">ğŸ‘‚</div>
                <div id="waves-container"></div>
            </div>

            <div class="w-full bg-slate-100 h-3 rounded-full mb-8">
                <div id="db-bar" class="h-full bg-red-500 w-0 transition-all duration-75"></div>
            </div>

            <button onclick="toggleRadar()" id="radar-btn" class="w-full py-6 bg-red-600 text-white rounded-3xl font-black text-2xl shadow-lg active:scale-95 transition-all">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙØ§ØªØ§Ø± (Ø§Ù„Ù…ØªÙ‚Ù† Ù„Ù„Ø­Ø±ÙƒØ§Øª) -->
    <div id="avatar-modal" class="modal">
        <div class="bg-white p-8 rounded-[60px] w-full max-w-4xl shadow-2xl relative">
            <button onclick="closeModals()" class="absolute top-8 left-8 text-3xl font-bold text-slate-300">Ã—</button>
            <div class="flex flex-col md:flex-row gap-8 items-center">
                <!-- Ø±Ø³Ù… Ø§Ù„Ø£ÙØ§ØªØ§Ø± -->
                <div class="w-full md:w-1/2 bg-slate-50 rounded-[45px] p-10 h-96 flex justify-center items-end border-2 border-slate-100">
                    <svg viewBox="0 0 200 200" class="w-full h-full">
                        <path d="M40,200 Q100,140 160,200" fill="#1e293b" />
                        <circle cx="100" cy="70" r="45" fill="#FFDBAC" />
                        <path id="av-mouth" d="M85,85 Q100,95 115,85" stroke="#333" stroke-width="2" fill="none" />
                        <circle cx="85" cy="65" r="4" fill="#333" />
                        <circle cx="115" cy="65" r="4" fill="#333" />

                        <!-- ÙŠØ¯ Ø§Ù„Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© -->
                        <g id="av-hand-group" class="hand-move" transform="translate(100, 140)">
                            <path d="M-20,0 Q0,-10 20,0 L15,30 L-15,30 Z" fill="#FFDBAC" />
                            <rect id="f-index" class="finger" x="-18" y="-38" width="7" height="38" rx="3.5" fill="#FFDBAC" />
                            <rect id="f-middle" class="finger" x="-7" y="-43" width="7" height="43" rx="3.5" fill="#FFDBAC" />
                            <rect id="f-ring" class="finger" x="4" y="-41" width="7" height="41" rx="3.5" fill="#FFDBAC" />
                            <rect id="f-pinky" class="finger" x="15" y="-33" width="7" height="33" rx="3.5" fill="#FFDBAC" />
                            <rect id="f-thumb" class="finger" x="22" y="-12" width="28" height="8" rx="4" fill="#FFDBAC" transform-origin="22 0" />
                        </g>
                    </svg>
                </div>
                <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
                <div class="w-full md:w-1/2">
                    <h2 class="text-3xl font-black text-purple-700 mb-2">Ø§Ù„Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ù…ØªØ±Ø¬Ù…</h2>
                    <p class="text-slate-400 mb-6">Ø¬Ø±Ø¨: (Ø£Ø­Ø¨ÙƒØŒ Ø´ÙƒØ±Ø§Ù‹ØŒ Ù…Ø§Ø¡ØŒ ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŒ ØµÙ„Ø§Ø©)</p>
                    <input type="text" id="av-input" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…ØªÙƒ Ù‡Ù†Ø§..." class="w-full p-6 bg-slate-100 rounded-3xl mb-4 border-none outline-none focus:ring-4 focus:ring-purple-200 text-2xl font-black text-center">
                    <button onclick="animateAvatar()" class="w-full py-6 bg-purple-600 text-white rounded-3xl font-black text-xl shadow-lg">ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ø±ÙƒØ©</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
    <div id="cam-modal" class="modal">
        <div class="bg-white p-8 rounded-[60px] w-full max-w-2xl text-center relative">
            <button onclick="closeModals()" class="absolute top-8 left-8 text-3xl font-bold text-slate-300">Ã—</button>
            <h2 class="text-2xl font-black mb-4">Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¹Ø¨Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</h2>
            <div class="relative aspect-video bg-black rounded-[40px] overflow-hidden border-8 border-white shadow-2xl">
                <video id="v-input" autoplay playsinline class="w-full h-full object-cover"></video>
                <canvas id="c-output" class="absolute inset-0 w-full h-full"></canvas>
            </div>
            <div id="gesture-res" class="mt-6 p-6 bg-blue-50 rounded-3xl text-3xl font-black text-blue-700">Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø´Ø§Ø±Ø© Ø§Ù„ÙŠØ¯...</div>
            <button onclick="initCamera()" class="w-full mt-4 py-4 bg-blue-600 text-white rounded-2xl font-bold">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
        </div>
    </div>

    <script>
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModals() { 
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
            if(window.aCtx) window.aCtx.close();
            document.getElementById('main-body').classList.remove('emergency-flash');
        }

        // --- Ù…Ø­Ø±Ùƒ Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª (Ø­Ø³Ø§Ø³ÙŠØ© Ù…ÙØ±Ø·Ø©) ---
        let radarActive = false;
        async function toggleRadar() {
            if(radarActive) { location.reload(); return; }
            radarActive = true;
            document.getElementById('radar-btn').innerText = "Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† (Ø§Ø¶ØºØ· Ù„Ù„Ø¥ÙŠÙ‚Ø§Ù)";
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                window.aCtx = new (window.AudioContext || window.webkitAudioContext)();
                const analyser = window.aCtx.createAnalyser();
                const source = window.aCtx.createMediaStreamSource(stream);
                source.connect(analyser);
                analyser.fftSize = 128;
                const buffer = new Uint8Array(analyser.frequencyBinCount);

                const icon = document.getElementById('mic-icon');
                const bar = document.getElementById('db-bar');
                const container = document.getElementById('waves-container');
                const body = document.getElementById('main-body');

                function loop() {
                    analyser.getByteFrequencyData(buffer);
                    let sum = 0; for(let x of buffer) sum += x;
                    let vol = sum / buffer.length;

                    bar.style.width = Math.min(vol * 2.5, 100) + "%";
                    icon.style.transform = `scale(${1 + vol/100})`;

                    if(vol > 20) { // Ø­Ø³Ø§Ø³ÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹
                        icon.innerText = "ğŸš¨";
                        body.classList.add('emergency-flash');
                        const w = document.createElement('div');
                        w.className = 'radar-wave';
                        container.appendChild(w);
                        setTimeout(() => w.remove(), 2000);
                        if(navigator.vibrate) navigator.vibrate(200);
                    } else {
                        icon.innerText = "ğŸ‘‚";
                        body.classList.remove('emergency-flash');
                    }
                    if(radarActive) requestAnimationFrame(loop);
                }
                loop();
            } catch(e) { alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†"); }
        }

        // --- Ù…Ø­Ø±Ùƒ Ø§Ù„Ø£ÙØ§ØªØ§Ø± (Ø¥ØªÙ‚Ø§Ù† Ø§Ù„Ø¥Ø´Ø§Ø±Ø©) ---
        function animateAvatar() {
            const input = document.getElementById('av-input').value.trim();
            const hand = document.getElementById('av-hand-group');
            const mouth = document.getElementById('av-mouth');
            const fngs = ['f-index', 'f-middle', 'f-ring', 'f-pinky', 'f-thumb'];

            // ØªØµÙÙŠØ± Ø§Ù„ÙˆØ¶Ø¹ÙŠØ©
            fngs.forEach(f => {
                const el = document.getElementById(f);
                el.style.transform = "scaleY(1) rotate(0deg)";
                el.style.opacity = "1";
            });
            hand.style.transform = "translate(100px, 140px) rotate(0deg)";

            // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…ØªÙ‚Ù†
            if(input.includes("Ø£Ø­Ø¨Ùƒ")) {
                document.getElementById('f-middle').style.transform = "scaleY(0.2)";
                document.getElementById('f-ring').style.transform = "scaleY(0.2)";
                hand.style.transform = "translate(100px, 130px) rotate(-10deg)";
            } else if(input.includes("Ø´ÙƒØ±Ø§") || input.includes("Ø´ÙƒØ±Ø§Ù‹")) {
                hand.animate([
                    { transform: 'translate(100px, 100px)' },
                    { transform: 'translate(100px, 160px)' }
                ], { duration: 1000, easing: 'ease-in-out' });
            } else if(input.includes("Ù…Ø§Ø¡")) {
                document.getElementById('f-index').style.transform = "scaleY(0.2)";
                document.getElementById('f-middle').style.transform = "scaleY(0.2)";
                document.getElementById('f-ring').style.transform = "scaleY(0.2)";
            } else if(input.includes("Ø­Ø§Ù„Ùƒ") || input.includes("ÙƒÙŠÙ")) {
                document.getElementById('f-thumb').style.transform = "rotate(-45deg)";
                hand.animate([{transform: 'translateX(80px)'}, {transform: 'translateX(120px)'}], {duration: 500, iterations: 2});
            } else if(input.includes("ØµÙ„Ø§Ø©")) {
                hand.style.transform = "translate(100px, 120px) rotate(-90deg)";
            }

            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙÙ… ÙˆØ§Ù„Ù†Ø·Ù‚
            mouth.setAttribute('d', 'M85,90 Q100,105 115,90');
            const s = new SpeechSynthesisUtterance(input);
            s.lang = 'ar-SA';
            s.onend = () => mouth.setAttribute('d', 'M85,85 Q100,95 115,85');
            window.speechSynthesis.speak(s);
        }

        // --- Ù…ØªØ±Ø¬Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ AI ---
        async function initCamera() {
            const video = document.getElementById('v-input');
            const canvas = document.getElementById('c-output');
            const ctx = canvas.getContext('2d');
            const res = document.getElementById('gesture-res');

            const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
            hands.setOptions({maxNumHands: 1, minDetectionConfidence: 0.7});
            
            hands.onResults(results => {
                ctx.save();
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if(results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    window.drawConnectors(ctx, results.multiHandLandmarks[0], HAND_CONNECTIONS, {color: '#3b82f6', lineWidth: 4});
                    res.innerText = "Ø¬Ø§Ø±ÙŠ ÙÙ‡Ù… Ø¥Ø´Ø§Ø±ØªÙƒ...";
                }
                ctx.restore();
            });

            const stream = await navigator.mediaDevices.getUserMedia({video: true});
            video.srcObject = stream;
            const cam = new Camera(video, {onFrame: async () => await hands.send({image: video}), width: 640, height: 480});
            cam.start();
        }
    </script>
</body>
</html>